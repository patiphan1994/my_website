<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Prompt', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .cart-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #eee; }
        .total-box { text-align: right; margin-top: 20px; font-size: 1.2rem; font-weight: bold; color: #f57224; }
        
        .form-group { margin-top: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px; }
        
        .btn-confirm { width: 100%; background: #f57224; color: white; border: none; padding: 15px; font-size: 1.1rem; cursor: pointer; border-radius: 4px; }
        .btn-confirm:hover { background: #d0611f; }
        .btn-clear { background: #999; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="container">
        <h2>üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <button class="btn-clear" onclick="clearCart()">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button></h2>
        <div id="cart-items">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>
        
        <div class="total-box">
            ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á: ‡∏ø50<br>
            ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="grand-total">‡∏ø0</span>
        </div>

        <hr>
        <h3>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
        <div class="form-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input type="text" id="c-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö">
        </div>
        <div class="form-group">
            <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input type="text" id="c-tel" placeholder="08x-xxxxxxx">
        </div>
        <div class="form-group">
            <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
            <textarea id="c-addr" rows="3" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ñ‡∏ô‡∏ô, ‡πÅ‡∏Ç‡∏ß‡∏á/‡πÄ‡∏Ç‡∏ï, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î..."></textarea>
        </div>

        <button class="btn-confirm" onclick="placeOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    </div>

    <script>
        // --- ‚ö†Ô∏è ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ Supabase ‡πÄ‡∏î‡∏¥‡∏° ---
        const SUPABASE_URL = '‡πÉ‡∏™‡πà_URL_‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà';
        const SUPABASE_KEY = '‡πÉ‡∏™‡πà_KEY_‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        const shippingCost = 50;

        function loadCart() {
            const list = document.getElementById('cart-items');
            const totalEl = document.getElementById('grand-total');
            
            if(cart.length === 0) {
                list.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö</p>";
                totalEl.innerText = "‡∏ø0";
                return;
            }

            list.innerHTML = "";
            let total = 0;
            
            cart.forEach((item, index) => {
                total += item.price;
                list.innerHTML += `
                    <div class="cart-item">
                        <span>${index+1}. ${item.name}</span>
                        <span>‡∏ø${item.price.toLocaleString()}</span>
                    </div>
                `;
            });

            totalEl.innerText = "‡∏ø" + (total + shippingCost).toLocaleString();
        }

        async function placeOrder() {
            const name = document.getElementById('c-name').value;
            const tel = document.getElementById('c-tel').value;
            const addr = document.getElementById('c-addr').value;

            if(!name || !tel || !addr || cart.length === 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
                return;
            }

            // ‡∏£‡∏ß‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            const itemString = cart.map(i => i.name).join(", ");
            const totalPrice = cart.reduce((sum, i) => sum + i.price, 0) + shippingCost;

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Supabase
            const { error } = await _supabase.from('orders').insert({
                customer_name: name,
                tel: tel,
                address: addr,
                total_price: totalPrice,
                items: itemString
            });

            if(error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
            } else {
                alert("‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏±‡∏ö");
                localStorage.removeItem('myCart'); // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                window.location.href = 'shop.html'; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡πâ‡∏≠‡∏õ
            }
        }

        function clearCart() {
            localStorage.removeItem('myCart');
            location.reload();
        }

        loadCart();
    </script>
</body>
</html>
